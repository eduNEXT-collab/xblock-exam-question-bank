{% load i18n %}
{% load django_markup %}

<div class="bank-container">
{% if block_count == 0 %}
    <div class="bank-summary">
        <h3>{% trans "Your Problem Bank is Empty" %}</h3>
        <p class="prompt-text">{% trans "To start, add problems to the bank." %}</p>
    </div>

{% elif max_count != -1 and max_count > block_count %}
    <div class="bank-summary bank-summary-error" role="alert" aria-live="assertive">
        <h3><strong>{% trans "Error:" %}</strong> {% trans "Problem Bank Summary" %}</h3>
        <div class="bank-stats">
            <div class="stat-block">
                <div class="stat-number">{{ block_count }}</div>
                <div class="stat-label">{% trans "Total problems" %}</div>
            </div>
            <div class="stat-block">
                <div class="stat-number"></div>
                <div class="stat-label">{% trans "Selected to show" %}</div>
            </div>
        </div>
        <p class="prompt-text">{% trans "More problems selected than available." %}</p>
    </div>
    <div class="bank-instruction">
        {% blocktrans trimmed asvar edit_msg %}
        Press {link_start}Edit{link_end} to configure settings.
        {% endblocktrans %}
        {% interpolate_html edit_msg link_start='<a href="#" class="edit-button action-button">'|safe link_end='</a>'|safe %}
    </div>

{% else %}
    <div class="bank-summary" aria-live="polite" aria-atomic="true">
        <h3>{% trans "Problem Bank Summary" %}</h3>
        <div class="bank-stats">
            <div class="stat-block">
                <div class="stat-number">{{ block_count }}</div>
                <div class="stat-label">{% trans "Total problems" %}</div>
            </div>
            <div class="stat-block">
                {% if max_count == -1 %}
                    <div class="stat-number">{% trans "All" %}</div>
                    <div class="stat-label">{% trans "Shown to learners" %}</div>
                {% else %}
                    <div class="stat-number total-selected-count"></div>
                    <div class="stat-label">{% trans "Selected to show" %}</div>
                {% endif %}
            </div>
        </div>
    </div>

	{% if collection_group or blocks %}
      <p class="bank-learner-info">
        {% trans "These are the problems in the bank:" %}
      </p>
    {% endif %}

	<div>
      {% if collection_group %}
        {% for coll_key, collection in collection_group.items %}
          <div class="collection" data-collection-key="{{ coll_key }}">
			<div class="collection-header">
			  <div>
			    <h3 class="collection-title">{{ collection.title }}</h3>
			    <h4 class="collection-description">{{ collection.description }}</h4>
			  </div>

			  {% if max_count != -1 %}
			    <form class="selected-quantity">
			  	<label for="problems-quantity-selector-{{ coll_key }}" class="input-label">{% trans "Number of problems to show" %}
			  	<input 
			  	  id="problems-quantity-selector-{{ coll_key }}"
			  	  name="{{ coll_key }}"
                    type="number"
                    min="1" 
                    max="{{ collection.problems|length }}"
			  	  value="{{ collection.problems|length }}"
                    oninput="if(this.value < 1) this.value = 1;"
                    required
			  	/>
			  	<span class="help-block">{% trans "max." %} {{ collection.problems|length }}</span>
			  	</label>
			    </form>
			  {% endif %}
			</div>
    
            {% if collection.problems %}
			  <div class="search-container">
			  	<input 
                  type="search" 
                  class="problem-search" 
                  placeholder="Search problems by title or content..."
                  aria-label="Search problems"
			  	/>
			  	<div class="search-results-info"></div>
				<button class="search-clear-btn" aria-label="Clear search">{% trans "Clear search" %}</button>
			  </div>
              <ol class="bank-problem-list">
                {% for problem_key, problem in collection.problems.items %}
                  <li class="problem-item" data-problem-key="{{ problem_key }}">{{ problem.name }}</li>
                {% endfor %}
              </ol>
            {% else %}
              <p class="no-problems">No problems in this collection.</p>
            {% endif %}
			<div class="view-elements-group">
				<button type="button" class="view-elements more"></button>
				<button type="button" class="view-elements less"></button>
			</div>
          </div>
        {% endfor %}
      {% else %}
        <p class="no-collections">No collections available.</p>
      {% endif %}
    </div>

    <div class="bank-instruction">
        {% blocktrans trimmed asvar view_msg %}
        Press {link_start}View{link_end} to preview components.
        {% endblocktrans %}
        {% interpolate_html view_msg link_start=view_link|safe link_end='</a>'|safe %}
    </div>
    <div class="bank-instruction">
        {% blocktrans trimmed asvar edit_msg %}
        Press {link_start}Edit{link_end} to configure settings.
        {% endblocktrans %}
        {% interpolate_html edit_msg link_start='<a href="#" class="edit-button action-button">'|safe link_end='</a>'|safe %}
    </div>
	{% endif %}
    {% if block_count > 0 %}
	<div class="bank-collections-section">
		<div class="refresh-text">
          {% blocktrans trimmed asvar refresh_count_msg %}
		  Load {bold_start}{count}{bold_end} problems
		  {% endblocktrans %}
          {% interpolate_html refresh_count_msg bold_start='<span>'|safe bold_end='</span>'|safe count=block_count %}
        </div>
		<button type="button" class="btn-refresh-collections">
			<span class="icon fa fa-refresh" aria-hidden="true"></span>
			{% trans "Refresh Collections" %}
		</button>
	</div>
	{% endif %}
</div>
